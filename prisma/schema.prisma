generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int    @id @default(autoincrement())
  name     String
  password String
  avatar   String
  phone    String @unique
  email    String @unique
  gender   Gender

  store    Store?
  routines Routine[]
  comment  Comment[]
}

enum Gender {
  MAN
  WOMON
}

model Product {
  id       Int    @id @default(autoincrement())
  name     String @unique
  brand    String
  price    String
  images   String
  category String
  capacity String
  mark     Float

  ingredients IngredientsOnProducts[]

  comments Comment[]

  storeProducts StoreProduct[]

  routineProducts RoutineProduct[]
}

model Ingredient {
  id   Int    @id @default(autoincrement())
  name String @unique

  products IngredientsOnProducts[]
}

model IngredientsOnProducts {
  product      Product    @relation(fields: [productId], references: [id])
  productId    Int
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id])
  ingredientId Int

  @@id([productId, ingredientId])
}

model Comment {
  id           Int      @id @default(autoincrement())
  content      String   @db.Text
  created_time DateTime @default(now())
  rank         Float

  user   User @relation(fields: [userId], references: [id])
  userId Int

  product   Product @relation(fields: [productId], references: [id])
  productId Int
}

enum ApplyingTime {
  ALL
  DAY
  Night
}

model Store {
  id     Int  @id @default(autoincrement())
  user   User @relation(fields: [userId], references: [id])
  userId Int  @unique

  storeProducts StoreProduct[]
}

model StoreProduct {
  id Int @id @default(autoincrement())

  store   Store @relation(fields: [storeId], references: [id])
  storeId Int

  product   Product @relation(fields: [productId], references: [id])
  productId Int

  amount       Int
  applyingTime ApplyingTime @default(ALL)
  expense      String

  productionTime DateTime
  shelfTime      Int
  openedTime     DateTime?
  isRunout       Boolean   @default(false)
}

model Routine {
  id     Int    @id @default(autoincrement())
  User   User   @relation(fields: [userId], references: [id])
  userId Int
  name   String

  routineProducts RoutineProduct[]

  edge Edge[]
}

model RoutineProduct {
  id Int @id @default(autoincrement())

  routine   Routine @relation(fields: [routineId], references: [id])
  routineId Int

  product   Product @relation(fields: [productId], references: [id])
  productId Int

  amount       Int
  applyingTime ApplyingTime @default(ALL)
  expense      String

  poductNode ProductNode?
}

model ProductNode {
  id    Int     @id @default(autoincrement())
  label String?
  x     Int
  y     Int

  routineProduct   RoutineProduct @relation(fields: [routineProductId], references: [id])
  routineProductId Int            @unique

  ingredientNodes IngredientNode[]
}

model IngredientNode {
  id    Int     @id @default(autoincrement())
  label String?
  x     Int
  y     Int

  ProductNode   ProductNode @relation(fields: [productNodeId], references: [id])
  productNodeId Int
}

enum EdgeType {
  PP
  PI
  II
}

model Edge {
  id       Int      @id @default(autoincrement())
  label    String?
  source   String
  target   String
  edgeType EdgeType

  routine   Routine? @relation(fields: [routineId], references: [id])
  routineId Int?
}
